<!DOCTYPE html>
<!-- saved from url=(0061)file:///C:/Users/%C3%BCmit/Desktop/BO%C5%9EPUANTAJMOTORU.html -->
<html lang="tr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEMÄ°ZLÄ°K BÄ°RÄ°MÄ° PUANTAJ SÄ°STEMÄ°</title>
    <link href="./TEMÄ°ZLÄ°K BÄ°RÄ°MÄ° PUANTAJ SÄ°STEMÄ°_files/css2" rel="stylesheet">
    <style>
        :root { --primary: #2c3e50; --green: #27ae60; --orange: #e67e22; --red: #c0392b; --blue: #2980b9; --dark: #1a252f; }
        body { margin: 0; background: #eef2f5; font-family: 'Roboto', sans-serif; }

        /* GÄ°RÄ°Å */
        #loginScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; z-index: 99999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        #loginBox { background: white; padding: 40px; border-radius: 10px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 320px; position: relative; }
        .prod-by { margin-top: 15px; font-size: 10px; color: #7f8c8d; font-weight: bold; letter-spacing: 1px; }

        /* ANA PANEL */
        #mainContent { display: none; padding-bottom: 50px; }
        .panel-container { background: white; padding: 15px; width: 98%; margin: 10px auto; border-radius: 10px; display: flex; gap: 15px; flex-wrap: wrap; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-top: 5px solid var(--blue); }
        .panel-col { flex: 1; min-width: 280px; display: flex; flex-direction: column; gap: 8px; position: relative; }
        
        h3 { margin: 0; font-size: 14px; border-bottom: 2px solid #eee; padding-bottom: 5px; color: var(--primary); text-transform: uppercase; cursor: text; transition: 0.2s;}
        h3:hover { background: #f0f8ff; }
        h3:focus { outline: 2px solid var(--blue); background: #fff; }

        .personel-row { display: flex; gap: 5px; margin-bottom: 5px; }
        .modern-input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 12px; box-sizing: border-box;}
        .personel-listesi { height: 180px; overflow-y: auto; border: 1px solid #ddd; background: #fff; padding: 5px; border-radius: 5px; }
        .personel-item { display: flex; justify-content: space-between; align-items: center; padding: 4px 8px; border-bottom: 1px solid #f0f0f0; font-size: 11px; }
        
        button { cursor: pointer; border: none; border-radius: 5px; font-weight: bold; color: white; transition: 0.2s; }
        .btn-add { background: var(--green); padding: 5px 10px; }
        .btn-del { background: var(--red); padding: 2px 6px; font-size: 10px; }
        .btn-del-group { position: absolute; right: 0; top: 0; background: var(--red); padding: 2px 8px; font-size: 10px; }
        .btn-big { width: 100%; padding: 15px; font-size: 14px; margin-top: 5px; text-transform: uppercase; box-shadow: 0 4px 0 rgba(0,0,0,0.2); }
        .btn-big:active { transform: translateY(3px); box-shadow: none; }
        .btn-org { background: var(--orange); } .btn-grn { background: var(--green); } .btn-blu { background: var(--blue); }

        /* VARDÄ°YA CHIPLERÄ° */
        .vardiya-chip { display:flex; align-items:center; background:#2ecc71; color:white; padding:6px 10px; border-radius:5px; font-size:11px; font-weight:bold; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
        .vardiya-chip.izin { background:#e74c3c; }
        .vardiya-del { margin-left:10px; cursor:pointer; font-size:12px; transition:0.2s;}
        .vardiya-del:hover { color:#2c3e50; }

        /* TABLO VE Ã‡IKTI */
        .sayfa { background: white; width: 297mm; min-height: 200mm; margin: 0 auto 20px auto; padding: 2mm; page-break-after: always; font-family: 'Arial Narrow', sans-serif; }
        
        table { width: 100%; border-collapse: collapse; table-layout: fixed; font-size: 7.5px; border: 1px solid #000; margin: 0; padding: 0; user-select: none; }
        
        th, td { 
            border: 1px solid #000; 
            text-align: center; 
            vertical-align: middle; 
            padding: 0px; 
            line-height: 1.1; 
            white-space: normal; 
            word-break: break-all; 
            overflow: hidden;
            position: relative;
        }
        
        .veri-hucre { font-size: 7px; font-weight: bold; height: 22px; }

        td[contenteditable="true"] { cursor: text; }
        td[contenteditable="true"]:focus, div[contenteditable="true"]:focus { background: #fff9c4 !important; outline: 1px solid orange; }

        /* SEÃ‡Ä°LMÄ°Å HÃœCRE STÄ°LÄ° */
        .selected-cell { background-color: #d0ebff !important; outline: 2px solid #1c7ed6 !important; z-index: 10; }
        
        /* SAÄ TIK MENÃœSÃœ EFEKTLERÄ° */
        .ctx-item { padding: 8px 15px; font-size: 13px; cursor: pointer; transition: 0.2s; font-family: 'Roboto', sans-serif; color: #333; }
        .ctx-item:hover { background-color: #f1f3f5; color: var(--blue); }

        col.c-sno { width: 16px; } col.c-tc { width: 55px; } col.c-isim { width: 85px; } col.c-gun { width: 18px; }
        th { background: #eee; padding: 2px 1px; }
        .bg-hafta { background-color: #dff0d8 !important; border-left: 1px solid #000; }
        .bg-genel { background-color: #fcf3cf !important; border-left: 1px solid #000; }
        .bg-gece { background-color: #e8daef !important; border-left: 1px solid #000; }
        .hucre-izin { background-color: #fadbd8 !important; color: #c0392b; font-weight: bold; }
        .hucre-haftasonu { background-color: #f2f2f2 !important; }
        
        .dikey-yazi { writing-mode: vertical-rl; transform: rotate(180deg); white-space: nowrap; margin: auto; font-size: 6px; font-weight: normal; letter-spacing: -0.4px; padding: 2px 0; line-height: 1; }
        .dikey-tarih { writing-mode: vertical-rl; transform: rotate(180deg); white-space: nowrap; margin: auto; font-size: 6px; font-weight: bold; letter-spacing: -0.2px; padding: 2px 0; line-height: 1.1; color: #111; }

        #dynamicGroups { display: flex; gap: 15px; flex-wrap: wrap; width: 100%; }

        /* EXCEL BUTONU TASARIMI */
        #btnExceleKopyala { position: fixed; bottom: 20px; right: 20px; background: #27ae60; color: white; border: none; padding: 15px 25px; border-radius: 50px; font-size: 14px; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; display: none; z-index: 100000; transition: 0.3s; }
        #btnExceleKopyala:hover { background: #219653; transform: scale(1.05); }

        @media print {
            @page { size: A4 landscape; margin: 2mm; }
            #loginScreen, .panel-container, #tableContextMenu, #btnExceleKopyala { display: none !important; }
            #mainContent { display: block !important; }
            .sayfa { margin: 0; padding: 0; width: 100%; border: none; box-shadow: none; page-break-after: always; }
            .selected-cell { outline: none !important; background-color: inherit !important; } 
        }
    </style>
</head>
<body>

<div id="loginScreen" style="display: none;">
    <div id="loginBox">
        <div style="font-size:40px;">ğŸ”’</div>
        <h2>TEMÄ°ZLÄ°K BÄ°RÄ°MÄ° PUANTAJ</h2>
        <input type="password" id="passInput" placeholder="Åifre: 1234" style="width:100%; padding:10px; text-align:center;">
        <button onclick="sifreKontrol()" style="background:var(--blue); width:100%; padding:12px; margin-top:10px;">GÄ°RÄ°Å YAP</button>
        <div class="prod-by">PROD.BY. UMIT ABI 2026</div>
    </div>
</div>

<div id="mainContent" style="display: block;">
    <div class="panel-container" style="border-top-color: var(--orange);">
        <div style="width:100%; padding-bottom:5px; border-bottom:2px solid #eee; margin-bottom:10px;">
            <h3 style="border:none; padding:0; display:inline-block; color:var(--orange);">VARDÄ°YA YÃ–NETÄ°MÄ° (Ayarlar)</h3>
            <span style="font-size:10px; color:#666; margin-left:10px;">Excel'de olan veya elle gireceÄŸiniz vardiyalarÄ±n Ã§alÄ±ÅŸma saatlerini buradan belirleyin.</span>
        </div>
        <div style="width:100%; display:flex; gap:10px; align-items:flex-end; flex-wrap:wrap;">
            <div style="flex:2; min-width: 150px;">
                <label style="font-size:10px; font-weight:bold;">Vardiya AdÄ± / Kodu</label>
                <input type="text" id="vAd" class="modern-input" placeholder="Ã–rn: 08:00-20:00 veya NÄ°">
            </div>
            <div style="flex:1; min-width: 80px;">
                <label style="font-size:10px; font-weight:bold;">Toplam Saat</label>
                <input type="number" id="vSaat" class="modern-input" placeholder="Ã–rn: 11" step="0.5">
            </div>
            <div style="flex:1; min-width: 80px;">
                <label style="font-size:10px; font-weight:bold;">Gece Saati</label>
                <input type="number" id="vGece" class="modern-input" placeholder="Ã–rn: 0" step="0.5">
            </div>
            <div style="flex:1.5; min-width: 120px;">
                <label style="font-size:10px; font-weight:bold;">TÃ¼r (Ã‡alÄ±ÅŸma/Ä°zin)</label>
                <select id="vTip" class="modern-input">
                    <option value="calisma">Ã‡alÄ±ÅŸma / Mesai</option>
                    <option value="izin">Ä°zin / Ä°stirahat</option>
                </select>
            </div>
            <div>
                <button onclick="vardiyaEkle()" class="btn-big btn-grn" style="margin:0; padding:8px 20px;">EKLE</button>
            </div>
        </div>
        <div id="vardiyaListesi" style="width:100%; display:flex; gap:8px; flex-wrap:wrap; margin-top:15px;"><div class="vardiya-chip calisma"><span>08:00-18:00 (9s / G:0s)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;08:00-18:00&#39;)">âœ–</span></div><div class="vardiya-chip calisma"><span>08:00-20:00 (11s / G:0s)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;08:00-20:00&#39;)">âœ–</span></div><div class="vardiya-chip calisma"><span>08:00-16:00 (7.5s / G:0s)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;08:00-16:00&#39;)">âœ–</span></div><div class="vardiya-chip calisma"><span>20:00-08:00 (11s / G:11s)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;20:00-08:00&#39;)">âœ–</span></div><div class="vardiya-chip calisma"><span>16:00-24:00 (7.5s / G:4s)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;16:00-24:00&#39;)">âœ–</span></div><div class="vardiya-chip calisma"><span>24:00-08:00 (7.5s / G:6s)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;24:00-08:00&#39;)">âœ–</span></div><div class="vardiya-chip izin"><span>HT (Ä°zin)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;HT&#39;)">âœ–</span></div><div class="vardiya-chip izin"><span>YÄ° (Ä°zin)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;YÄ°&#39;)">âœ–</span></div><div class="vardiya-chip izin"><span>R (Ä°zin)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;R&#39;)">âœ–</span></div><div class="vardiya-chip izin"><span>Ä° (Ä°zin)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;Ä°&#39;)">âœ–</span></div><div class="vardiya-chip izin"><span>NÄ° (Ä°zin)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;NÄ°&#39;)">âœ–</span></div><div class="vardiya-chip izin"><span>RT (Ä°zin)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;RT&#39;)">âœ–</span></div><div class="vardiya-chip calisma"><span>RTÃ‡ (9s / G:0s)</span><span class="vardiya-del" onclick="vardiyaSil(&#39;RTÃ‡&#39;)">âœ–</span></div></div>
    </div>

    <div class="panel-container">
        <div id="dynamicGroups">
        <div class="panel-col">
            <button class="btn-del-group" onclick="grupSil(&#39;g_1&#39;)" title="Grubu Sil">X</button>
            <h3 contenteditable="true" onblur="grupAdiGuncelle(&#39;g_1&#39;, this.innerText)">DÃ–ÅEMEALTI DEVLET HASTANESÄ°</h3>
            <div class="personel-row"><input type="text" id="add_g_1" class="modern-input" placeholder="Personel AdÄ±..." onkeypress="if(event.key===&#39;Enter&#39;) personelEkle(&#39;g_1&#39;)"><button onclick="personelEkle(&#39;g_1&#39;)" class="btn-add">+</button></div>
            <div class="personel-listesi"><div class="personel-item"><span>ADEM KÃ–MÃœR</span><button onclick="personelSil(&#39;g_1&#39;, &#39;ADEM KÃ–MÃœR&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>ALÄ° GENÃ‡EL</span><button onclick="personelSil(&#39;g_1&#39;, &#39;ALÄ° GENÃ‡EL&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>AYÅE BOZKAYA</span><button onclick="personelSil(&#39;g_1&#39;, &#39;AYÅE BOZKAYA&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>BETÃœL ÅÄ°MÅEK</span><button onclick="personelSil(&#39;g_1&#39;, &#39;BETÃœL ÅÄ°MÅEK&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>BURCU DERELÄ°OÄLU</span><button onclick="personelSil(&#39;g_1&#39;, &#39;BURCU DERELÄ°OÄLU&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>DENÄ°Z USLU</span><button onclick="personelSil(&#39;g_1&#39;, &#39;DENÄ°Z USLU&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>ENES ABDULLAH ALTUN</span><button onclick="personelSil(&#39;g_1&#39;, &#39;ENES ABDULLAH ALTUN&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>FATMA Ã‡ALIÅKAN</span><button onclick="personelSil(&#39;g_1&#39;, &#39;FATMA Ã‡ALIÅKAN&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>GÃœLBAHAR ÃœNVER</span><button onclick="personelSil(&#39;g_1&#39;, &#39;GÃœLBAHAR ÃœNVER&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>GÃœLLÃœ TOSUN</span><button onclick="personelSil(&#39;g_1&#39;, &#39;GÃœLLÃœ TOSUN&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>HALÄ°L VAR</span><button onclick="personelSil(&#39;g_1&#39;, &#39;HALÄ°L VAR&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>HATÄ°CE YILDIRIM</span><button onclick="personelSil(&#39;g_1&#39;, &#39;HATÄ°CE YILDIRIM&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>HURÄ°YE ELMAS</span><button onclick="personelSil(&#39;g_1&#39;, &#39;HURÄ°YE ELMAS&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>Ä°RFAN CAN DEMÄ°R</span><button onclick="personelSil(&#39;g_1&#39;, &#39;Ä°RFAN CAN DEMÄ°R&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>KADÄ°R GAMSIZ</span><button onclick="personelSil(&#39;g_1&#39;, &#39;KADÄ°R GAMSIZ&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>MAKBULE DENK</span><button onclick="personelSil(&#39;g_1&#39;, &#39;MAKBULE DENK&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>MEHMET OÄUZ</span><button onclick="personelSil(&#39;g_1&#39;, &#39;MEHMET OÄUZ&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>MERVE Ã–Z</span><button onclick="personelSil(&#39;g_1&#39;, &#39;MERVE Ã–Z&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>MUSTAFA DÄ°K</span><button onclick="personelSil(&#39;g_1&#39;, &#39;MUSTAFA DÄ°K&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>NAZMÄ°YE DURAN</span><button onclick="personelSil(&#39;g_1&#39;, &#39;NAZMÄ°YE DURAN&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>NEJLA NÄ°LÄ°</span><button onclick="personelSil(&#39;g_1&#39;, &#39;NEJLA NÄ°LÄ°&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>ORHAN KAHRAMAN</span><button onclick="personelSil(&#39;g_1&#39;, &#39;ORHAN KAHRAMAN&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>Ã–ZLEM DURSUN</span><button onclick="personelSil(&#39;g_1&#39;, &#39;Ã–ZLEM DURSUN&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>SADIK MACÄ°T</span><button onclick="personelSil(&#39;g_1&#39;, &#39;SADIK MACÄ°T&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>SAFÄ°YE DENECÄ°</span><button onclick="personelSil(&#39;g_1&#39;, &#39;SAFÄ°YE DENECÄ°&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>SEDA YILMAZ</span><button onclick="personelSil(&#39;g_1&#39;, &#39;SEDA YILMAZ&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>SONGÃœL DÄ°LEK</span><button onclick="personelSil(&#39;g_1&#39;, &#39;SONGÃœL DÄ°LEK&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>SONGÃœL ERDOÄAN</span><button onclick="personelSil(&#39;g_1&#39;, &#39;SONGÃœL ERDOÄAN&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>SONGÃœL Ã–ZTÃœRK</span><button onclick="personelSil(&#39;g_1&#39;, &#39;SONGÃœL Ã–ZTÃœRK&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>ÅAHABETTÄ°N ORHAN</span><button onclick="personelSil(&#39;g_1&#39;, &#39;ÅAHABETTÄ°N ORHAN&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>TAYYÄ°P DOÄAN</span><button onclick="personelSil(&#39;g_1&#39;, &#39;TAYYÄ°P DOÄAN&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>YASEMÄ°N KARAKUÅ</span><button onclick="personelSil(&#39;g_1&#39;, &#39;YASEMÄ°N KARAKUÅ&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>ZELÄ°HA ERSOY</span><button onclick="personelSil(&#39;g_1&#39;, &#39;ZELÄ°HA ERSOY&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>ZEYNEP BOZAN</span><button onclick="personelSil(&#39;g_1&#39;, &#39;ZEYNEP BOZAN&#39;)" class="btn-del">X</button></div></div></div>
        <div class="panel-col">
            <button class="btn-del-group" onclick="grupSil(&#39;g_1771960208804&#39;)" title="Grubu Sil">X</button>
            <h3 contenteditable="true" onblur="grupAdiGuncelle(&#39;g_1771960208804&#39;, this.innerText)">ATATÃœRK DEVLET HASTANESÄ°</h3>
            <div class="personel-row"><input type="text" id="add_g_1771960208804" class="modern-input" placeholder="Personel AdÄ±..." onkeypress="if(event.key===&#39;Enter&#39;) personelEkle(&#39;g_1771960208804&#39;)"><button onclick="personelEkle(&#39;g_1771960208804&#39;)" class="btn-add">+</button></div>
            <div class="personel-listesi"><div class="personel-item"><span>BURAK TURAN</span><button onclick="personelSil(&#39;g_1771960208804&#39;, &#39;BURAK TURAN&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>FATMA IÅIK</span><button onclick="personelSil(&#39;g_1771960208804&#39;, &#39;FATMA IÅIK&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>FATMA KOÃ‡AR</span><button onclick="personelSil(&#39;g_1771960208804&#39;, &#39;FATMA KOÃ‡AR&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>HAFÄ°SE DÄ°KMEN</span><button onclick="personelSil(&#39;g_1771960208804&#39;, &#39;HAFÄ°SE DÄ°KMEN&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>HATÄ°CE KARAKUÅ</span><button onclick="personelSil(&#39;g_1771960208804&#39;, &#39;HATÄ°CE KARAKUÅ&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>NUSRETTÄ°N Ã–ZSOY</span><button onclick="personelSil(&#39;g_1771960208804&#39;, &#39;NUSRETTÄ°N Ã–ZSOY&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>ÃœMÄ°T YÄ°ÄÄ°T</span><button onclick="personelSil(&#39;g_1771960208804&#39;, &#39;ÃœMÄ°T YÄ°ÄÄ°T&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>ÃœMMÃœ KURU</span><button onclick="personelSil(&#39;g_1771960208804&#39;, &#39;ÃœMMÃœ KURU&#39;)" class="btn-del">X</button></div></div></div>
        <div class="panel-col">
            <button class="btn-del-group" onclick="grupSil(&#39;g_1771960210748&#39;)" title="Grubu Sil">X</button>
            <h3 contenteditable="true" onblur="grupAdiGuncelle(&#39;g_1771960210748&#39;, this.innerText)">EÄÄ°TÄ°M ARAÅTIRMA HASTANESÄ°</h3>
            <div class="personel-row"><input type="text" id="add_g_1771960210748" class="modern-input" placeholder="Personel AdÄ±..." onkeypress="if(event.key===&#39;Enter&#39;) personelEkle(&#39;g_1771960210748&#39;)"><button onclick="personelEkle(&#39;g_1771960210748&#39;)" class="btn-add">+</button></div>
            <div class="personel-listesi"><div class="personel-item"><span>BETÃœL ÅÄ°MÅEK</span><button onclick="personelSil(&#39;g_1771960210748&#39;, &#39;BETÃœL ÅÄ°MÅEK&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>FUNDA POYRAZ</span><button onclick="personelSil(&#39;g_1771960210748&#39;, &#39;FUNDA POYRAZ&#39;)" class="btn-del">X</button></div><div class="personel-item"><span>HAFÄ°ZE Ã–NAL</span><button onclick="personelSil(&#39;g_1771960210748&#39;, &#39;HAFÄ°ZE Ã–NAL&#39;)" class="btn-del">X</button></div></div></div></div>
        <div class="panel-col" style="flex:1; min-width: 250px; justify-content: center; align-items: center; border: 2px dashed #ccc; border-radius: 10px; padding: 20px;">
            <button onclick="yeniGrupEkle()" class="btn-big btn-blu">+ YENÄ° GRUP EKLE</button>
        </div>
        <div class="panel-col" style="flex:100%; border-top: 1px solid #eee; padding-top: 15px; margin-top: 5px;">
            <div style="display:flex; gap:10px;">
                <input type="date" id="inpTarihBas" class="modern-input" title="BaÅŸlangÄ±Ã§ Tarihi">
                <input type="date" id="inpTarihBit" class="modern-input" title="BitiÅŸ Tarihi">
                <button onclick="raporuOlustur()" class="btn-big btn-org" style="margin:0; flex:2;">PUANTAJ OLUÅTUR</button>
                <button onclick="window.print()" class="btn-big btn-grn" style="margin:0; flex:1;">YAZDIR</button>
            </div>
            <textarea id="inpExcel" placeholder="Excel&#39;den kopyaladÄ±ÄŸÄ±nÄ±z vardiyalarÄ± buraya yapÄ±ÅŸtÄ±rÄ±n..." style="height:150px; margin-top: 10px;" class="modern-input"></textarea>
            <div style="margin-top: 5px; font-size: 11px; color: #e67e22; font-weight: bold;">ğŸ’¡ Ä°PUCU: Tabloda oluÅŸturulan hÃ¼creleri farenizle sÃ¼rÃ¼kleyerek seÃ§ebilir, ardÄ±ndan saÄŸ tÄ±klayarak hÃ¼creleri birleÅŸtirebilirsiniz! Hastane adÄ± ve kod kÄ±sÄ±mlarÄ±na tÄ±klayarak metinleri kendi hastanenize gÃ¶re dÃ¼zenleyebilirsiniz.</div>
        </div>
    </div>
    <div id="raporAlani"></div>
</div>

<button id="btnExceleKopyala" onclick="exceleSifirKayipsizKopyala()">ğŸ“‹ EXCEL'E KOPYALA</button>

<div id="tableContextMenu" style="display:none; position:absolute; background:white; border:1px solid #ced4da; box-shadow:0 4px 12px rgba(0,0,0,0.15); z-index:99999; border-radius:5px; overflow:hidden;">
    <div class="ctx-item" onclick="mergeSelectedCells()">ğŸ”— SeÃ§ili HÃ¼creleri BirleÅŸtir</div>
    <div style="border-bottom: 1px solid #eee;"></div>
    <div class="ctx-item" onclick="unmergeSelectedCells()">âœ‚ï¸ HÃ¼cre BirleÅŸtirmesini AyÄ±r</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let passInput = document.getElementById('passInput');
    if (passInput) passInput.addEventListener('keypress', function (e) { if (e.key === 'Enter') sifreKontrol(); });
    
    // GeÃ§erli ayÄ± otomatik seÃ§mek iÃ§in
    let bugun = new Date();
    let bas = new Date(bugun.getFullYear(), bugun.getMonth(), 15);
    let bit = new Date(bugun.getFullYear(), bugun.getMonth() + 1, 14);
    document.getElementById('inpTarihBas').value = bas.toISOString().split('T')[0];
    document.getElementById('inpTarihBit').value = bit.toISOString().split('T')[0];
    
    veriYukle();
});

const DEFAULT_VARDIYALAR = { 
    "08:00-18:00":{t:9,g:0, tip:"calisma"}, "08:00-20:00":{t:11,g:0, tip:"calisma"}, "08:00-16:00":{t:7.5,g:0, tip:"calisma"}, 
    "20:00-08:00":{t:11,g:11, tip:"calisma"}, "16:00-24:00":{t:7.5,g:4, tip:"calisma"}, "24:00-08:00":{t:7.5,g:6, tip:"calisma"}, 
    "HT":{t:0,g:0, tip:"izin"}, "YÄ°":{t:0,g:0, tip:"izin"}, "R":{t:0,g:0, tip:"izin"}, "Ä°":{t:0,g:0, tip:"izin"}, 
    "NÄ°":{t:0,g:0, tip:"izin"}, "RT":{t:0,g:0, tip:"izin"}, "RTÃ‡":{t:9,g:0, tip:"calisma"} 
};

let appData = { gruplar: [], vardiyalar: null };

function sifreKontrol() {
    // Åifreyi burada 1234 yaptÄ±k
    if(document.getElementById('passInput').value.trim() === "1234") {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
    } else alert("HATALI ÅÄ°FRE!");
}

function veriYukle() {
    // TarayÄ±cÄ±daki eski boÅŸ listeyi unutup bu yeni listeyi yÃ¼klemesi iÃ§in anahtarÄ± deÄŸiÅŸtirdik
    let kayit = localStorage.getItem("guvenlik_puantaj_genel_liste");
    if (kayit) appData = JSON.parse(kayit);
    if (!appData.vardiyalar) appData.vardiyalar = DEFAULT_VARDIYALAR;
    
    // GÃ–NDERDÄ°ÄÄ°N LÄ°STE BURADA:
    const genelListe = [
        "ORHAN KAHRAMAN", "HAFÄ°SE DÄ°KMEN", "ZELÄ°HA ERSOY", "TAYYÄ°P DOÄAN", "ÅAHABETTÄ°N ORHAN", 
        "KADÄ°R GAMSIZ", "MEHMET OÄUZ", "MAKBULE DENK", "GÃœLBAHAR ÃœNVER", "NAZMÄ°YE DURAN", 
        "SONGÃœL ERDOÄAN", "Ã–ZLEM DURSUN", "YASEMÄ°N KARAKUÅ", "BURCU DERELÄ°OÄLU", "HALÄ°L VAR", 
        "ZEYNEP BOZAN", "DENÄ°Z USLU", "NUSRETTÄ°N Ã–ZSOY", "SONGÃœL DÄ°LEK", "FATMA KOÃ‡AR", 
        "BURAK TURAN", "FATMA Ã‡ALIÅKAN", "FATMA IÅIK", "SADIK MACÄ°T", "MUSTAFA DÄ°K", 
        "ÃœMMÃœ KURU", "SAFÄ°YE DENECÄ°", "NEJLA NÄ°LÄ°", "HAFÄ°ZE Ã–NAL", "MERVE Ã–Z", 
        "HATÄ°CE YILDIRIM", "FUNDA POYRAZ", "BETÃœL ÅÄ°MÅEK", "Ä°RFAN CAN DEMÄ°R", "AYÅE BOZKAYA", 
        "HATÄ°CE KARAKUÅ", "SONGÃœL Ã–ZTÃœRK", "ENES ABDULLAH ALTUN", "HURÄ°YE ELMAS", 
        "SEDA YILMAZ", "ADEM KÃ–MÃœR"
    ];

    // EÄŸer sistemde kayÄ±tlÄ± bir grup yoksa, doÄŸrudan genel listeyi oluÅŸtur
    if (!appData.gruplar || appData.gruplar.length === 0) {
        appData.gruplar = [{ id: "g_1", ad: "TÃœM PERSONEL (GENEL LÄ°STE)", kisiler: genelListe }];
    }
    
    veriKaydet(); arayuzCiz(); vardiyaArayuzCiz();
}

function veriKaydet() { localStorage.setItem("guvenlik_puantaj_genel_liste", JSON.stringify(appData)); }

function vardiyaEkle() {
    let kod = document.getElementById("vAd").value.trim().toUpperCase();
    let t = parseFloat(document.getElementById("vSaat").value) || 0;
    let g = parseFloat(document.getElementById("vGece").value) || 0;
    let tip = document.getElementById("vTip").value;
    if(!kod) return alert("Vardiya adÄ±/kodu boÅŸ olamaz!");
    appData.vardiyalar[kod] = { t: t, g: g, tip: tip };
    veriKaydet(); vardiyaArayuzCiz();
    document.getElementById("vAd").value = ""; document.getElementById("vSaat").value = ""; document.getElementById("vGece").value = "";
}

function vardiyaSil(kod) { if(confirm(kod + " vardiyasÄ±nÄ± silmek istediÄŸinize emin misiniz?")) { delete appData.vardiyalar[kod]; veriKaydet(); vardiyaArayuzCiz(); } }

function vardiyaArayuzCiz() {
    const root = document.getElementById("vardiyaListesi"); root.innerHTML = "";
    for(let v in appData.vardiyalar) {
        let info = appData.vardiyalar[v];
        let cClass = info.tip === 'izin' ? 'izin' : 'calisma';
        let desc = info.tip === 'calisma' ? `(${info.t}s / G:${info.g}s)` : '(Ä°zin)';
        root.innerHTML += `<div class="vardiya-chip ${cClass}"><span>${v} ${desc}</span><span class="vardiya-del" onclick="vardiyaSil('${v}')">âœ–</span></div>`;
    }
}

function formatliVardiya(val) { if(!val) return ""; val = val.trim(); if(val.match(/\d{2}:\d{2}.*\d{2}:\d{2}/)) return val.replace(/[\s-]+/, "<br>"); return val; }
function getCleanValue(html) { return html.replace(/<br\s*\/?>/gi, "-").replace("&nbsp;", " ").trim().toUpperCase(); }

function getVardiyaInfo(val) {
    if (!val) return {t:0, g:0, tip:"bilinmeyen", val:""};
    let cleanVal = val.replace(/<br\s*\/?>/gi, "-").trim().toUpperCase(); 
    if (appData.vardiyalar[cleanVal]) return { ...appData.vardiyalar[cleanVal], val: cleanVal };
    let valWithHyphen = cleanVal.replace(/[\s\n\r]+/g, "-");
    if (appData.vardiyalar[valWithHyphen]) return { ...appData.vardiyalar[valWithHyphen], val: valWithHyphen };
    return {t:0, g:0, tip:"bilinmeyen", val: cleanVal};
}

function yeniGrupEkle() { appData.gruplar.push({ id: "g_" + Date.now(), ad: "YENÄ° GRUP", kisiler: [] }); veriKaydet(); arayuzCiz(); }
function grupSil(id) { if (confirm("Grup silinsin mi?")) { appData.gruplar = appData.gruplar.filter(g => g.id !== id); veriKaydet(); arayuzCiz(); } }
function grupAdiGuncelle(id, ad) { let g = appData.gruplar.find(g => g.id === id); if (g) { g.ad = ad.trim() || "Ä°SÄ°MSÄ°Z GRUP"; veriKaydet(); } }

function personelEkle(grupId) {
    let input = document.getElementById("add_" + grupId); let isim = input.value.trim().toUpperCase();
    let grup = appData.gruplar.find(g => g.id === grupId);
    if (isim && grup && !grup.kisiler.includes(isim)) { grup.kisiler.push(isim); veriKaydet(); arayuzCiz(); }
    input.value = "";
}
function personelSil(gId, isim) { if (confirm("Silinsin mi?")) { let g = appData.gruplar.find(g => g.id === gId); g.kisiler = g.kisiler.filter(k => k !== isim); veriKaydet(); arayuzCiz(); } }

function arayuzCiz() {
    const container = document.getElementById("dynamicGroups"); container.innerHTML = "";
    appData.gruplar.forEach(grup => {
        let html = `
        <div class="panel-col">
            <button class="btn-del-group" onclick="grupSil('${grup.id}')" title="Grubu Sil">X</button>
            <h3 contenteditable="true" onblur="grupAdiGuncelle('${grup.id}', this.innerText)">${grup.ad}</h3>
            <div class="personel-row"><input type="text" id="add_${grup.id}" class="modern-input" placeholder="Personel AdÄ±..." onkeypress="if(event.key==='Enter') personelEkle('${grup.id}')"><button onclick="personelEkle('${grup.id}')" class="btn-add">+</button></div>
            <div class="personel-listesi">`;
        grup.kisiler.sort((a,b)=>a.localeCompare(b,'tr')).forEach((isim) => {
            html += `<div class="personel-item"><span>${isim}</span><button onclick="personelSil('${grup.id}', '${isim}')" class="btn-del">X</button></div>`;
        });
        container.innerHTML += html + `</div></div>`;
    });
}

function tarihGuncelle(){ let bas=new Date(document.getElementById('inpTarihBas').value); let bit=new Date(document.getElementById('inpTarihBit').value); return {bas,bit,str: `${bas.toLocaleDateString('tr-TR')} - ${bit.toLocaleDateString('tr-TR')}`}; }
function getKey(d){return d.getFullYear()+(d.getMonth()+1).toString().padStart(2,'0')+d.getDate().toString().padStart(2,'0');}
function excelTarih(s){if(!s)return null; let m=s.trim().match(/^(\d{1,2})[./](\d{1,2})[./](\d{4})$/); return m?m[3]+m[2].padStart(2,'0')+m[1].padStart(2,'0'):null;}

function satirHesapla(td) {
    let tr = td.parentElement, cells = tr.querySelectorAll('.veri-hucre:not([style*="display: none"])');
    let rawVal = getCleanValue(td.innerHTML);
    let hs=0, hg=0, hi=0;
    let ag=0, as=0, n_rt=0, n_ht=0, n_r=0, n_i=0, n_rtc=0, n_htc=0, age=0, totalFM=0;

    cells.forEach((c) => {
        if(c.hasAttribute('data-merged-by')) return; 
        
        let val = getCleanValue(c.innerHTML); 
        let info = getVardiyaInfo(val);
        let realVal = info.val;
        let isIzin = (info.tip === "izin");

        if(realVal === "RT") n_rt++;
        else if(realVal === "HT") n_ht++;
        else if(realVal === "R") n_r++;
        else if(isIzin && !["RT","HT","R"].includes(realVal)) n_i++;

        if(info.t > 0) {
            ag += 1;
            as += info.t;
            age += info.g;
            hs += info.t;
            hg += info.g;
            if(realVal === "RTÃ‡") n_rtc++;
        }

        if(c.classList.contains("hucre-haftasonu") && info.t > 0) n_htc++;

        if(c.nextElementSibling && c.nextElementSibling.classList.contains('bg-hafta')) {
            let n = c.nextElementSibling;
            if(n) { 
                n.innerText = hs||""; 
                n = n.nextElementSibling; 
                while(n && n.style.display === 'none') n = n.nextElementSibling;
                n.innerText = hg||""; 
                n = n.nextElementSibling; 
                while(n && n.style.display === 'none') n = n.nextElementSibling;
                n.innerText = hi||""; 
            }
            totalFM += Math.max(0, hs - 45);
            hs=0; hg=0; hi=0;
        }
    });

    totalFM += Math.max(0, hs - 45);

    if(tr.querySelector('.s-calisma')) {
        tr.querySelector('.s-calisma').innerText = ag + n_rt + n_ht + n_i + n_r;
        tr.querySelector('.s-yol').innerText = ag + n_rtc;
        tr.querySelector('.s-rapor').innerText = n_r || "0";
        tr.querySelector('.s-izin').innerText = n_i || "0";
        tr.querySelector('.s-ht').innerText = n_ht || "0";
        tr.querySelector('.s-rt').innerText = n_rt || "0";
        tr.querySelector('.s-rtc').innerText = n_rtc || "0";
        tr.querySelector('.s-htc').innerText = n_htc * 9 || "0";
        tr.querySelector('.s-fm').innerText = totalFM || "0";
        tr.querySelector('.s-gece').innerText = age || "0";
        tr.querySelector('.s-tgece').innerText = age || "0";
    }
    
    td.innerHTML = formatliVardiya(rawVal);
}

function raporuOlustur() {
    const {bas,bit,str} = tarihGuncelle();
    let days=[]; let d=new Date(bas); while(d<=bit){ days.push(new Date(d)); d.setDate(d.getDate()+1); }
    
    let people = {};
    appData.gruplar.forEach(grup => {
        grup.kisiler.forEach(n => { people[n] = { n: n, gId: grup.id, gAd: grup.ad, data: {} }; });
    });

    const raw = document.getElementById('inpExcel').value.split('\n').filter(r=>r.trim());
    let map = {};
    raw.forEach(row => {
        let cols = row.split('\t'); let isHead=false, tmp={};
        cols.forEach((c,i)=>{ let k=excelTarih(c); if(k){tmp[k]=i; isHead=true;} });
        if(isHead) map=tmp;
        else {
            let name = cols[0].trim().toUpperCase();
            if(name.length>2 && people[name]) {
                for(let k in map) {
                    let v = (cols[map[k]]||"").trim();
                    if(v) people[name].data[k] = v;
                }
            }
        }
    });

    Object.values(people).forEach(p => {
        days.forEach(day => { let k = getKey(day); if(!p.data[k]) p.data[k] = (day.getDay()===0||day.getDay()===6) ? "HT" : "08:00-18:00"; });
    });

    const HDR = [{n:"Ã‡ALIÅMA GÃœNÃœ", c:"s-calisma"}, {n:"Ä°.GELME G.(YOL)", c:"s-yol"}, {n:"RAPOR", c:"s-rapor"}, {n:"Ä°ZÄ°N", c:"s-izin"}, {n:"HT", c:"s-ht"}, {n:"RT", c:"s-rt"}, {n:"RTÃ‡", c:"s-rtc"}, {n:"HT Ã‡ALIÅMA", c:"s-htc"}, {n:"F.MESAÄ° SAAT", c:"s-fm"}];
    
    let sayfaHtml = ""; let gArr = Object.values(people).reduce((acc, p) => { acc[p.gAd] = acc[p.gAd]||[]; acc[p.gAd].push(p); return acc; }, {});
    
    for(let gAd in gArr) {
        let list = gArr[gAd].sort((a,b)=>a.n.localeCompare(b.n,'tr'));
        let h = `<div class="sayfa"><table class="veri-tablosu" data-grup="${gAd}">
        <colgroup><col class="c-sno"><col class="c-tc"><col class="c-isim">`;
        days.forEach(d=>{ h+=`<col class="c-gun">`; if(d.getDay()===0) h+=`<col class="c-gun"><col class="c-gun"><col class="c-gun">`; });
        HDR.forEach(()=>h+=`<col class="c-gun">`);
        h+=`<col class="c-gun"><col class="c-gun"></colgroup><thead>
        <tr>
            <td colspan="4" style="border: none !important; text-align: left;"><img src="https://upload.wikimedia.org/wikipedia/commons/e/e4/T.C._Sa%C4%9Fl%C4%B1k_Bakanl%C4%B1%C4%9F%C4%B1_Logo.png" style="height: 40px; margin-top:5px; margin-left: 10px;"></td>
            <td colspan="${days.length + Math.floor(days.length/7)*3 + HDR.length - 1}" style="border: none !important; text-align: center; vertical-align: middle;">
                <div contenteditable="true" style="font-weight: bold; font-size: 14px; letter-spacing: 1px; margin-bottom: 2px;">.................... HASTANESÄ° BAÅHEKÄ°MLÄ°ÄÄ°</div>
                <div style="font-size: 10px; font-weight: bold;">GÃœVENLÄ°K BÄ°RÄ°MÄ° / SÃœREKLÄ° Ä°ÅÃ‡Ä° NÃ–BET LÄ°STESÄ° VE PUANTAJ CETVELÄ° (${str})</div>
            </td>
            <td colspan="3" style="border: none !important; text-align: right; font-size: 10px; font-family: 'Times New Roman', serif; padding-bottom: 10px;" contenteditable="true">
                Kodu: ............. &nbsp;&nbsp;|&nbsp;&nbsp; YayÄ±n Tarihi: .../.../....... &nbsp;&nbsp;|&nbsp;&nbsp; Revizyon Tarihi: 0 &nbsp;&nbsp;|&nbsp;&nbsp; Revizyon No: 0 &nbsp;&nbsp;|&nbsp;&nbsp; Sayfa No/SayÄ±sÄ±: 1/1
            </td>
        </tr>
        <tr><th>S.NO</th><th>TC KÄ°MLÄ°K NO</th><th style="border:none;">ADI SOYADI</th>`;
        
        days.forEach(d=>{
            let gg = String(d.getDate()).padStart(2, '0');
            let aa = String(d.getMonth() + 1).padStart(2, '0');
            let yyyy = d.getFullYear();
            let gunAdi = d.toLocaleDateString('tr-TR', { weekday: 'long' }).toUpperCase();
            let tamTarih = `${gg}/${aa}/${yyyy}<br><span style="font-weight:normal; font-size:5.5px">${gunAdi}</span>`;
            let s=`<th style="${(d.getDay()===0||d.getDay()===6)?'background:#eee':''}; border-top:none;"><div class="dikey-tarih">${tamTarih}</div></th>`;
            if(d.getDay()===0) s+=`<th class="bg-hafta" style="border-top:none"><div class="dikey-yazi">H.SAAT</div></th><th class="bg-hafta" style="border-top:none"><div class="dikey-yazi">H.GÃœN</div></th><th class="bg-hafta" style="border-top:none"><div class="dikey-yazi" style="color:red">H.Ä°ZÄ°N</div></th>`;
            h+=s;
        });

        HDR.forEach(b => { h += `<th class="bg-genel" style="border-top:none"><div class="dikey-yazi">${b.n}</div></th>`; });
        h += `<th class="bg-gece" style="border-top:none"><div class="dikey-yazi">GECE SAAT</div></th><th class="bg-gece" style="border-top:none; border-right:none"><div class="dikey-yazi">TOPLAM GECE</div></th></tr>
        </thead>
        <tbody>`;

        list.forEach((p, index)=>{
            h+=`<tr><td contenteditable="true">${index + 1}</td><td contenteditable="true"></td><td class="isim-hucre" style="border-left:none; text-align:left; padding-left:3px;" contenteditable="true">${p.n}</td>`;
            let hs=0, hg=0, hi=0;
            let ag=0, as=0, n_rt=0, n_ht=0, n_r=0, n_i=0, n_rtc=0, n_htc=0, age=0, totalFM=0;

            days.forEach(d=>{
                let info = getVardiyaInfo(p.data[getKey(d)]);
                let v = info.val;
                let isIzin = (info.tip === "izin");

                if(v === "RT") n_rt++; else if(v === "HT") n_ht++; else if(v === "R") n_r++; else if(isIzin && !["RT","HT","R"].includes(v)) n_i++;
                if(info.t > 0) { ag++; as+=info.t; age+=info.g; hs+=info.t; hg+=info.g; if(v==="RTÃ‡") n_rtc++; }
                let isHS = (d.getDay()===0||d.getDay()===6);
                if(isHS && info.t > 0) n_htc++;

                let bg=isHS?'hucre-haftasonu':''; if(isIzin) bg='hucre-izin';
                h+=`<td contenteditable="true" class="veri-hucre ${bg}" onblur="satirHesapla(this)">${formatliVardiya(v)}</td>`;
                if(d.getDay()===0){
                    totalFM += Math.max(0, hs - 45);
                    h+=`<th class="bg-hafta veri-hucre">${hs||""}</th><th class="bg-hafta veri-hucre">${hg||""}</th><th class="bg-hafta veri-hucre" style="color:red">${hi||""}</th>`;
                    hs=0; hg=0; hi=0;
                }
            });

            totalFM += Math.max(0, hs - 45);

            h+=`<th class="bg-genel s-calisma">${ag+n_rt+n_ht+n_i+n_r}</th><th class="bg-genel s-yol">${ag+n_rtc}</th><th class="bg-genel s-rapor">${n_r||"0"}</th>
            <th class="bg-genel s-izin">${n_i||"0"}</th><th class="bg-genel s-ht">${n_ht||"0"}</th><th class="bg-genel s-rt">${n_rt||"0"}</th>
            <th class="bg-genel s-rtc">${n_rtc||"0"}</th><th class="bg-genel s-htc">${n_htc*9||"0"}</th><th class="bg-genel s-fm">${totalFM||"0"}</th>
            <th class="bg-gece s-gece">${age||"0"}</th><th class="bg-gece s-tgece" style="border-right:none">${age||"0"}</th></tr>`;
        });

        let colCount = 3 + days.length + Math.floor(days.length/7)*3 + HDR.length + 2;

        h+=`</tbody>
        <tfoot>
            <tr>
                <td colspan="${colCount}" style="border: none !important; text-align: left; padding-top: 5px;">
                    <div style="font-size: 8px; font-weight: bold; color: #2c3e50;">NOT: "Fazla Mesai Saat" = HaftalÄ±k 45 Saati AÅŸan Mesailer ToplamÄ±dÄ±r. AyrÄ±ca "GÃ¼ndÃ¼z Fazla Mesai ToplamÄ±" ve "Gece Fazla Mesai ToplamÄ±" SÃœTUNUNA MANUEL OLARAK Ä°ÅLENMÄ°ÅTÄ°R</div>
                </td>
            </tr>
            <tr>
                <td colspan="${colCount}" style="border: none !important; text-align: center; font-weight: bold; font-size: 11px; padding: 5px 0;">
                    AÃ‡IKLAMALAR
                </td>
            </tr>
            <tr>
                <td colspan="${colCount}" style="border: 1px solid #000 !important; text-align: left; font-size: 9px; padding: 4px;" contenteditable="true">
                    <strong>1-</strong> (Buraya hastanenize Ã¶zel aÃ§Ä±klamalarÄ±nÄ±zÄ±, yol parasÄ± alacak personelleri vb. yazabilirsiniz...)
                </td>
            </tr>
            <tr>
                <td colspan="${colCount}" style="border: 1px solid #000 !important; text-align: left; font-size: 9px; padding: 4px;" contenteditable="true">
                    <strong>2-</strong> 
                </td>
            </tr>
            <tr>
                <td colspan="${Math.floor(colCount/2)}" style="border: 1px solid #000 !important; border-right: none !important; text-align: left; font-size: 7px; padding: 4px; vertical-align: top;">
                    <div contenteditable="true" style="margin-bottom:2px;">1-Devreden Ã‡alÄ±ÅŸma Saati; Bir Ã¶nceki ayÄ±n son artÄ±k haftasÄ±ndan kalan Ã§alÄ±ÅŸma saatidir.</div>
                    <div contenteditable="true">2-Hafta ToplamÄ±; Ã‡alÄ±ÅŸma saatine dahil olan mesailerin saat toplamÄ±dÄ±r.</div>
                </td>
                <td colspan="${Math.ceil(colCount/2)}" style="border: 1px solid #000 !important; border-left: none !important; text-align: left; font-size: 7px; padding: 4px; vertical-align: top;">
                    <div contenteditable="true" style="margin-bottom:2px;">9-Hafta Tatili ToplamÄ±; Hafta sonu(HT) gÃ¼n toplamÄ± girilir.</div>
                    <div contenteditable="true">10-Resmi Tatil(Tam GÃ¼n)(RT); Resmi Tatilde tam gÃ¼n Ã§alÄ±ÅŸan personellerin, Ã§alÄ±ÅŸma saati girilir.</div>
                </td>
            </tr>
            <tr>
                <td colspan="${Math.floor(colCount/3)}" style="border: none !important; text-align: center; font-size: 11px; padding-top: 25px;" contenteditable="true">
                    <strong>DÃ¼zenleyen</strong><br>TEMÄ°ZLÄ°K Birim Sorumlusu<br><br><br>...................
                </td>
                <td colspan="${Math.floor(colCount/3)}" style="border: none !important; text-align: center; font-size: 11px; padding-top: 25px;" contenteditable="true">
                    <strong>Kontrol Eden</strong><br>Ä°dari ve Mali Ä°ÅŸler MÃ¼dÃ¼r YardÄ±mcÄ±sÄ±<br><br><br>...................
                </td>
                <td colspan="${colCount - 2*Math.floor(colCount/3)}" style="border: none !important; text-align: center; font-size: 11px; padding-top: 25px;" contenteditable="true">
                    <strong>Onaylayan</strong><br>Ä°dari ve Mali Ä°ÅŸler MÃ¼dÃ¼rÃ¼<br><br><br>...................
                </td>
            </tr>
        </tfoot>
        </table></div>`;
        sayfaHtml+=h;
    }
    document.getElementById('raporAlani').innerHTML = sayfaHtml;
    document.getElementById('inpExcel').value="";
    document.getElementById('btnExceleKopyala').style.display = "block";
}

// ------------------------------------
// HÃœCRE BÄ°RLEÅTÄ°RME (MERGE) Ä°ÅLEMLERÄ°
// ------------------------------------
let isSelecting = false;
let startCell = null;
let selectedCells = [];

function getRowIdx(td) { return Array.from(td.parentNode.parentNode.children).indexOf(td.parentNode); }
function getColIdx(td) {
    let tr = td.parentNode;
    let idx = 0;
    for (let i = 0; i < tr.children.length; i++) {
        if (tr.children[i] === td) return idx;
        idx += parseInt(tr.children[i].getAttribute('colspan') || 1);
    }
    return idx;
}
function getCellAt(tr, targetColIdx) {
    let idx = 0;
    for (let i = 0; i < tr.children.length; i++) {
        let cell = tr.children[i];
        if (idx === targetColIdx) return cell;
        idx += parseInt(cell.getAttribute('colspan') || 1);
    }
    return null;
}

function clearSelection() {
    selectedCells.forEach(td => {
        if(td) td.classList.remove('selected-cell');
    });
    selectedCells = [];
}

function selectRectangle(start, end) {
    clearSelection();
    let r1 = getRowIdx(start), r2 = getRowIdx(end);
    let c1 = getColIdx(start), c2 = getColIdx(end);
    let minR = Math.min(r1, r2), maxR = Math.max(r1, r2);
    let minC = Math.min(c1, c2), maxC = Math.max(c1, c2);

    let tbody = start.closest('tbody');
    let rows = tbody.children;

    for (let r = minR; r <= maxR; r++) {
        let tr = rows[r];
        let tds = tr.children;
        for (let c = minC; c <= maxC; c++) {
            let td = tds[c];
            if (td && td.style.display !== 'none' && !td.hasAttribute('colspan')) {
                td.classList.add('selected-cell');
                selectedCells.push(td);
            }
        }
    }
}

document.addEventListener('mousedown', function(e) {
    if (e.button !== 0) return; 
    if (e.target.closest('#tableContextMenu')) return;

    if (e.target.tagName === 'TD' && e.target.closest('.veri-tablosu') && !e.target.hasAttribute('colspan')) {
        isSelecting = true;
        startCell = e.target;
        clearSelection();
        e.target.classList.add('selected-cell');
        selectedCells.push(e.target);
    } else clearSelection();
});

document.addEventListener('mouseover', function(e) {
    if (isSelecting && e.target.tagName === 'TD' && e.target.closest('.veri-tablosu') && !e.target.hasAttribute('colspan')) selectRectangle(startCell, e.target);
});
document.addEventListener('mouseup', function() { isSelecting = false; });

document.addEventListener('contextmenu', function(e) {
    if (e.target.tagName === 'TD' && e.target.closest('.veri-tablosu') && !e.target.hasAttribute('colspan')) {
        e.preventDefault();
        if (!selectedCells.includes(e.target)) {
            clearSelection();
            e.target.classList.add('selected-cell');
            selectedCells.push(e.target);
        }
        let ctxMenu = document.getElementById('tableContextMenu');
        ctxMenu.style.display = 'block';
        ctxMenu.style.left = e.pageX + 'px';
        ctxMenu.style.top = e.pageY + 'px';
    }
});

function mergeSelectedCells() {
    document.getElementById('tableContextMenu').style.display = 'none';
    if (selectedCells.length <= 1) return clearSelection();

    selectedCells.sort((a, b) => {
        let rDiff = getRowIdx(a) - getRowIdx(b);
        return rDiff !== 0 ? rDiff : getColIdx(a) - getColIdx(b);
    });

    let mainCell = selectedCells[0];
    mergeCounter++;
    let mergeId = "merge_" + mergeCounter;
    
    let isRowMerge = getRowIdx(selectedCells[0]) === getRowIdx(selectedCells[1]);

    if (isRowMerge) {
        let totalColSpan = 0;
        let mergedText = "";
        selectedCells.forEach((td, index) => {
            totalColSpan += parseInt(td.getAttribute('colspan') || 1);
            let val = getCleanValue(td.innerHTML);
            if(val !== "" && mergedText === "") mergedText = td.innerHTML; 
            
            if (index > 0) {
                td.style.display = 'none';
                td.setAttribute('data-merged-by', mergeId);
                td.innerHTML = ""; 
            }
        });
        mainCell.setAttribute('colspan', totalColSpan);
        mainCell.setAttribute('data-merge-id', mergeId);
        mainCell.innerHTML = mergedText;
    } 
    else {
        let totalRowSpan = 0;
        let mergedText = "";
        selectedCells.forEach((td, index) => {
            totalRowSpan += parseInt(td.getAttribute('rowspan') || 1);
            let val = getCleanValue(td.innerHTML);
            if(val !== "" && mergedText === "") mergedText = td.innerHTML; 

            if (index > 0) {
                td.style.display = 'none';
                td.setAttribute('data-merged-by', mergeId);
                td.innerHTML = ""; 
            }
        });
        mainCell.setAttribute('rowspan', totalRowSpan);
        mainCell.setAttribute('data-merge-id', mergeId);
        mainCell.innerHTML = mergedText;
    }

    satirHesapla(mainCell); 
    clearSelection();
}

let mergeCounter = 0;

function unmergeSelectedCells() {
    document.getElementById('tableContextMenu').style.display = 'none';
    
    selectedCells.forEach(td => {
        if (td.hasAttribute('colspan') || td.hasAttribute('rowspan')) {
            let mergeId = td.getAttribute('data-merge-id');
            if (mergeId) {
                td.removeAttribute('colspan');
                td.removeAttribute('rowspan');
                td.removeAttribute('data-merge-id');
                
                let tbody = td.closest('tbody');
                let hiddenCells = tbody.querySelectorAll(`td[data-merged-by="${mergeId}"]`);
                
                hiddenCells.forEach(hiddenTd => {
                    hiddenTd.style.display = '';
                    hiddenTd.removeAttribute('data-merged-by');
                    satirHesapla(hiddenTd);
                });
            }
        }
    });
    
    if(selectedCells.length > 0) satirHesapla(selectedCells[0]);
    clearSelection();
}

window.onclick = function(e) { if (!e.target.closest('#tableContextMenu')) document.getElementById('tableContextMenu').style.display = 'none'; };

// ------------------------------------
// EXCEL'E KOPYALAMA SÄ°STEMÄ° (SIFIR KAYIP)
// ------------------------------------
function exceleSifirKayipsizKopyala() {
    const tablolar = document.querySelectorAll('.veri-tablosu');
    if (tablolar.length === 0) return alert("Kopyalanacak tablo yok!");

    let combinedHtml = `
    <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
    <head>
        <meta charset="utf-8">
        <style>
            table { border-collapse: collapse; font-family: 'Arial Narrow', sans-serif; }
            th, td { border: 0.5pt solid black; text-align: center; vertical-align: middle; white-space: normal; }
            .dikey-yazi, .dikey-tarih { mso-rotate: 90; height: 80px; }
            .bg-hafta { background-color: #dff0d8; }
            .bg-genel { background-color: #fcf3cf; }
            .bg-gece { background-color: #e8daef; }
        </style>
    </head>
    <body>`;

    tablolar.forEach(tablo => {
        let clone = tablo.cloneNode(true);
        
        let hiddenCells = clone.querySelectorAll('td[style*="display: none"]');
        hiddenCells.forEach(cell => {
            if(cell.parentNode) cell.parentNode.removeChild(cell);
        });

        // Mavi seÃ§im renklerini temizleme
        let selected = clone.querySelectorAll('.selected-cell');
        selected.forEach(c => c.classList.remove('selected-cell'));

        combinedHtml += clone.outerHTML + "<br><br><br>"; 
    });

    combinedHtml += "</body></html>";

    const blob = new Blob([combinedHtml], { type: 'text/html' });
    try {
        const data = [new ClipboardItem({ 'text/html': blob })];
        navigator.clipboard.write(data).then(() => {
            alert("âœ… TÃ¼m sayfa Excel uyumlu panoya kopyalandÄ±!\n\nÅimdi Excel'i aÃ§Ä±p CTRL+V ile yapÄ±ÅŸtÄ±rÄ±n.");
        }).catch(err => kopyalamaYedekYontemi(combinedHtml));
    } catch (e) {
        kopyalamaYedekYontemi(combinedHtml);
    }
}

function kopyalamaYedekYontemi(htmlStr) {
    let tempDiv = document.createElement('div');
    tempDiv.innerHTML = htmlStr;
    tempDiv.style.position = 'absolute';
    tempDiv.style.left = '-9999px';
    document.body.appendChild(tempDiv);
    
    let range = document.createRange();
    range.selectNodeContents(tempDiv);
    let sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
    
    try {
        document.execCommand('copy');
        alert("âœ… TÃ¼m sayfa Excel uyumlu panoya kopyalandÄ±!\n\nÅimdi Excel'i aÃ§Ä±p CTRL+V ile yapÄ±ÅŸtÄ±rÄ±n.");
    } catch (err) {
        alert("Kopyalama baÅŸarÄ±sÄ±z oldu. TarayÄ±cÄ±nÄ±z desteklemiyor olabilir.");
    }
    
    document.body.removeChild(tempDiv);
}
</script>


</body></html>
